\documentclass{bayeshyp}

\listfiles

\usepackage[logonly]{trace}% for debugging purposes only
\usepackage{lipsum}% for testing purposes only
\usepackage[math]{blindtext}% for testing purposes only

% FIXME hackish workaround that should be fixed upstream in Tufte-LaTeX
% Set up the spacing using fontspec features
\usepackage{ifxetex}
\ifxetex
  \renewcommand\allcapsspacing[1]{{\addfontfeature{LetterSpace=15}#1}}
  \renewcommand\smallcapsspacing[1]{{\addfontfeature{LetterSpace=10}#1}}
\fi

\title{Bayesian Hypothesis Testing Without Tears}
\subtitle{Examples for Students}
\authors{%
  Eric-Jan Wagenmakers,
  Michael D. Lee,
  Jeffrey N. Rouder,
  Dora Matzke,
  Maarten Marsman,
  Jonathon Love,
  Alexander Ly,
  Ravi Selkser,
  Tahira Jamil,
  Quentin F. Gronau,
  Richard D. Morey
}
\publisher{Jasp Publishing}


% FIXME Temporary
\let\subsubsection\subsection

\usepackage{bayeshypdoc}

\begin{document}

\maketitle

\tableofcontents

\mainmatter

\setcounter{secnumdepth}{1}

\part{Documentation}

\chapter{Features of \texttt{bayeshyp.cls}}

\section{Title page}

The title page has a new design and a couple new macros to go along with it.

\paragraph{Subtitle}

A subtitle may be specified using the \syn|\subtitle| macro:

\begin{syntax}
  \subtitle{Examples for Students}
\end{syntax}

\paragraph{Multiple authors}

A comma-separated list of authors may be provided using the \syn|\authors| macro. For example:
\begin{syntax}
  \authors{
    Eric-Jan Wagenmakers,
    Michael D. Lee,
    Jeffrey N. Rouder,
    Dora Matzke,
    Maarten Marsman,
    Jonathon Love,
    Alexander Ly,
    Ravi Selkser,
    Tahira Jamil,
    Quentin F. Gronau,
    Richard D. Morey
  }
\end{syntax}

The authors are listed on the title page in the order provided.
Author names will not be split across lines.

\section{Headings}

Some headings have been modified to provide more typesetting options than usual. These modifications were done at the cost of backward-compatibility, however.

The original heading commands general follow the following format:
\begin{syntax}
  \chapter[<toc entry>]{Chapter title}
\end{syntax}

The new format requires that \syn|<toc entry>| be assigned to the new \syn|toc| key. The optional argument now contains a list of key--value pairs:
\begin{syntax}
  \chapter[<key-value pairs>]{Chapter title}
\end{syntax}

The key--value pairs differ based on the heading level.

\begin{itemize}
  \item \syn|toc| \textit{(part, chapter)} This is the text you wish to appear
    in the table of contents for this heading. If left unspecified, it defaults
    to the full text of the heading. This option is useful if your heading
    contains special formatting that needs to be adjusted for typesetting in
    the table of contents or if the heading is very long and you want a shorter
    heading for the table of contents. For chapter headings, this entry is also
    used for the running heads at the top of the pages.
  \item \syn|image| \textit{(part)} On part pages, an image may be included.
    This option specifies the filename for the image.
  \item \syn|image-options| \textit{(part)} This option specifies any
    key--value options that should be passed to the \syn|\includegraphics|
    macro used to insert the image on the part page. See the \texttt{graphics}
    package documentation for details.
  \item \syn|byline| \textit{(chapter)} Chapter headings may include a byline
    to list a chapter author, for example. The byline is not included in the
    table of contents entry. Example: \syn|\chapter[byline={with Kevin Godby}]{Chapter heading}|.
\end{itemize}




\section{Mathematical notation shortcuts}

\paragraph{Conditional probabilities}
To typeset probabilities or conditional probabilities in math mode, use the \syn|\p| macro:
\begin{syntax}
  \p(<variable>)
  \p(<hypothesis>|<evidence>)
  \p*(<hypothesis>|<evidence>)
  \p[<size>](<hypothesis>|<evidence>)
\end{syntax}
where \syn|<variable>|, \syn|<hypothesis>|, and \syn|<evidence>| are mathematical expressions or variables.
The \syn|\p*| variant will autoscale the parentheses and vertical bar to fit the contents of the expressions.
You can specify a particular size using the \syn|\p[<size>]| variant.
Possible sizes are \syn|\big|, \syn|\Big|, \syn|\bigg|, and \syn|\Bigg|.
Note also that the arguments to the \syn|\p| macro are delimited by parentheses and not braces.

\begin{gather*}
  \p(x) \quad \p(x|y) \quad \p(\text{has cancer} | \text{tested positive}) \\
  \p*(\frac{1+2}{3+4} | \sqrt{\frac{1}{1+\frac{1}{1+\frac{1}{1+\frac{1}{2}}}}}) \\
  \p[\bigg](\frac{1+2}{3+4} | \sqrt{\frac{1}{2}})
\end{gather*}


\section{Matlab code listings}

The \texttt{matlab} environment is used to display Matlab code listings.

\begin{syntax}
  \begin{matlab}[<additional settings>]
    % Matlab code goes here...

    disp('Look, a margin note!'); (*@ This comment appears in the margin note area... @*)
  \end{matlab}
\end{syntax}

Additional key--value settings for the environment may be passed as an optional argument.
Text between \syn|(*@| and \syn|*@)| will be typeset as a margin note.

\begin{matlab}
% This code listing is for Matlab code.
% This is a regular Matlab code comment.

disp('Look, a margin note!'); (*@ This comment appears in the margin note area. It may contain \LaTeX{} formatting commands and math: \[ \frac{ \p(A|B) = \p(B|A) \p(A)}{\p(B)}\text{.} \] @*)

disp('Another margin note.'); (*@ line \the\value{lstnumber}: Another margin note. @*)
% And some more random Matlab code just to pad things out a bit more...

disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('A margin note on the next page.'); (*@ Yet another margin note. @*)
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
disp('More code...');
\end{matlab}


%
%
% Tests
%
%

\part{Demonstrations}

\chapter{Chapter heading}
\section{Section heading}
\subsection{Subsection heading}
\paragraph{Paragraph heading} \ldots

\begin{graybg}[][h]
  This gray box has no title. \lipsum[2]

  A sample image:

  \includegraphics[width=0.9\linewidth]{example-image-a}
\end{graybg}

\begin{graybg}[Frequentist subjectivity]
  ``Today one wonders how it is possible that orthodox logic continues to be
  taught in some places year after year and praised as `objective', while
  Bayesians are charged with `subjectivity'. Orthodoxians, preoccupied with
  fantasies about nonexistent data sets and, in principle, unobservable
  limiting frequencies---while ignoring relevant prior information---are in no
  position to charge anybody with `subjectivity'."\cite{Jaynes2003}
\end{graybg}

Testing citation \cite{Jaynes2003}.

\lipsum

\begin{graybg*}[Frequentist subjectivity]
  ``Today one wonders how it is possible that orthodox logic continues to be
  taught in some places year after year and praised as `objective', while
  Bayesians are charged with `subjectivity'. Orthodoxians, preoccupied with
  fantasies about nonexistent data sets and, in principle, unobservable
  limiting frequencies---while ignoring relevant prior information---are in no
  position to charge anybody with `subjectivity'."\cite{Jaynes2003}
\end{graybg*}

\begin{graybg}[The zeros trick, ones trick, and WBDev]
  \index{WBDev}
  The zeros trick and ones trick are extremely useful, and relatively easy to
  implement in many cases, but a little difficult to understand conceptually.
  The key insight is that the negative log-likelihood of a sample of 0 from
  $\mathrm{Poisson}\bigl(\phi\bigr)$ is $\phi$, and similarly for a sample of 1
  from $\mathrm{Bernoulli}\bigl(\theta\bigr)$ it is $\theta$. So, by setting
  $\log \phi$ or $\theta$ appropriately, and forcing 1 or 0 to be observed,
  sampling effectively proceeds from the distribution defined by $\phi$ or
  $\theta$.

  More complicated extensions to the distributions and functions available in
  WinBUGS require using the WinBUGS Development Interface
  \cite{Lunn2003}. This is an add-on program that allows the user to
  hand-code functions and distributions in Component Pascal.
  \cite{Abelson1997} provide a tutorial on WBDev that includes
  simple worked examples of defining new distributions and functions. More
  detailed cognitive science applications are provided by
  \cite{AczelEtAl2017} implementing the Expectancy-Valence model of
  decision-making as a function in WBDev, and \cite{VandekerckhoveEtAl2011}
  implementing the drift-diffusion model as a distribution in WBDev. Both of
  these applications would be impractical without WBDev.
\end{graybg}

\lipsum

\begin{graybg}[Assessing and improving convergence]
  \index{convergence}
  In a perfect world, a single MCMC chain would immediately begin drawing
  samples from the posterior distribution, and the only computational issue
  would be how many are needed to form a sufficiently precise approximation.
  This ideal state of affairs is often not what happens, and latent-mixture
  models are notorious for needing convergence checks. So, this is a good place
  to list some checks.\cite{Gelman1996,GelmanHill2007}

  The basic principle is that, when the sampling process has converged, chains
  with substantially different starting values should be indistinguishable from
  each other. One implication of this requirement is that chains should vary
  around a constant mean, so a slow drift up or down signals a problem. And, if
  the sampling process has converged, each individual chain should look like a
  ``fat hairy caterpillar," because this visual appearance is generated when
  successive values are relatively independent. As a formal test for
  convergence, the $\hat{R}$ statistic\cite{GelmanRubin1992} is widely used.
  It is basically a measure of between-chain to within-chain variance, and so
  values close to 1 indicate convergence. As a rule of thumb, values higher
  than 1.1 are (deeply) suspect. If you were not paying much attention to the
  \texttt{rhat} values WinBUGS is returning to Matlab and R in previous
  modeling exercises, now is a good time to start checking them.

  There are three basic remedies for a lack of convergence, easily implemented
  in WinBUGS for any model. The first is simply to collect many more samples,
  or more chains of samples, and wait (and hope) for convergence. The second is
  to increase the number of \emph{burn-in}\index{burn-in} samples, which are
  initial samples in a chain that are discarded. This will be effective if
  separate chains are sensitive to their starting points, and take some time to
  converge. A worked example of this is presented in Section~\ref{hsdt}. The
  third is to \emph{thin}\index{thinning} the samples, by retaining only one
  out of every $n$. This will be effective if a chain is autocorrelated, with
  lack of independence between samples. A worked example of this is presented
  in Section~\ref{surveys}. There are other, more advanced, methods for
  improving convergence in WinBUGS, involving changing the model itself. Worked
  examples of the \emph{parameter expansion} method are presented in
  Sections~\ref{hesdt} and \ref{lmpt}.\label{assessingconvergence}
\end{graybg}

\lipsum

\begin{graybg}[Scripts for graphical models]
  The scripts that implement graphical models in WinBUGS are declarative,
  rather than procedural. This means the order of the commands does not matter.
  All that a script does is define the observed and unobserved variables in a
  graphical model, saying how they are distributed, and how they relate to each
  other. This is inherently a structure, rather than a process, and so order is
  not important. In practice this means, for example, that a separate loop is
  not needed in a script like \texttt{Exam\_2.txt} to define \texttt{k[i]},
  \texttt{z[i]}, and \texttt{phi[i]}. Exactly the same graphical model would be
  defined if they were all placed inside one \texttt{for (i in 1:p)} loop.
  Sometimes, however, it is conceptually clearer to use separate loops to
  implement different parts of a graphical
  model.\label{scriptsforgraphicalmodels}
\end{graybg}

\lipsum

\chapter{Chapter heading}
\blindtext
\section{Section heading}%
\blindtext

\begin{graybg}[An example image]
  This box contains an example image:\cite{Jaynes2003}

  \begin{center}
    \includegraphics[width=0.75\linewidth]{interpretation}
  \end{center}
  \caption{Caption test of \texttt{graybg} float environment.}
\end{graybg}

\chapter[byline={with Kevin}]{Chapter heading}
\section{Section heading}
\subsection{Subsection heading}
\paragraph{Paragraph heading} \ldots


\Blinddocument

\part[image={example-image-a}]{Graphical Practice}

\part[image={example-image-b},image-options={width=0.25\textwidth},toc={Shorter part title}]{Super long part title that wouldn't fit nicely in a table of contents or running head}
\chapter{Chapter heading}
\section{Section heading}
\section{Another section heading---this one longer to force wrapping in the table of contents}
\lipsum

\part[toc={Old-style, short title=this}]{Another super long part title that wouldn't fit nicely in a table of contents or running head}

\chapter{Graphical Integrity}
\setcounter{page}{53}

\chapter{Sources of Graphical Integrity and Sophistication}
\setcounter{page}{79}

\part{Theory of Data Graphics}

\chapter{Data-Ink and Graphical Redesign}
\setcounter{page}{91}

\chapter{Chartjunk: Vibrations, Grids, and Ducks}
\setcounter{page}{107}

\chapter{Data-Ink Maximization and Graphical Design}
\setcounter{page}{123}

\chapter{Multifunctioning Graphical Elements}
\setcounter{page}{139}

\chapter{Data Density and Small Multiples}
\setcounter{page}{161}

\chapter{Aesthetics and Technique in Data Graphical Design}
\setcounter{page}{177}

\chapter{An Incredibly Lengthy Title to Force the Table of Contents Entry to Wrap onto a Second Line}
\setcounter{page}{181}

\appendix

\chapter{Just an Appendix}
\setcounter{page}{183}

\chapter{And Another}
\setcounter{page}{185}

\backmatter
\chapter{Epilogue: Designs for the Display of Information}
\setcounter{page}{191}

\bibliography{test}
\bibliographystyle{plainnat}


\end{document}

